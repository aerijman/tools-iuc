<tool id="igblast" name="Igblast tool" version="1.15.0">
  <requirements>
    <requirement type="package" version="1.15.0">igblast</requirement> 
  </requirements>
  <command detect_errors="exit_code">
    <![CDATA[


    echo '${os.path.join($histdb.extra_files_path, "blastdb")}';



    ln -s /Users/aerijman/Documents/projects/tools-iuc/tools/igblast/test-data/database;

    igblastn -ig_seqtype '${seqtype}' 
    -num_threads 20 
    -germline_db_V database/'${germline_v}' 
    -germline_db_J database/'${germline_j}' 
    -germline_db_D database/'${germline_d}' 
    -organism '${organism}' 
    -auxiliary_data database/'${auxiliary_data}' 
    -query <(python '$__tool_directory__/fastq2fasta.py' -in '${fastq_input}')
    
  ]]></command>
  <inputs>
    <!-- Fastq input file -->
    <param type="data" name="fastq_input" label="Fastq input file" format="fastq" help="fastq input file. This could be the output of pResto workflow"/>
    <!-- ig sequence type -->
    <param type="select" display="radio" name="seqtype" label="Sequence type">
      <option value="TCR">TCR</option>
      <option value="IG" selected="True">Ig</option> 
    </param>
    <!-- references datasets -->
    <!--<param name="database" type="hidden" value="" />-->
    <param name="histdb" type="data" format="blastdbn" label="Nucleotide BLAST database" />
    <!--<param name="subject" type="hidden" value="" />-->
    
    <param type="text" name="database" label="Path to the germline database" help="path to the gemline database"/>
    <param type="text" name="germline_v" label="v germline prefix filename (fasta)" help="prefix for v dataset"/>
    <param type="text" name="germline_d" label="d germline prefix filename (fasta)" help="prefix for d dataset"/>
    <param type="text" name="germline_j" label="j germline prefix filename (fasta)" help="prefix for j dataset"/>
    <param type="text" name="auxiliary_data" label="auxiliary filename (fasta)" help="prefix for auxiliary dataset"/> 

    <!--<param type="data" name="germline_db_V" label="Germline db V" format="fa" help="Dataset with V sequence"/>
    <param type="data" name="germline_db_D" label="Germline db D" format="fa" help="Dataset with D sequence"/>
    <param type="data" name="germline_db_J" label="Germline db J" format="fa" help="Dataset with J sequence"/>-->        
    
    <!-- organism -->       
    <param name="organism" label="Organism" type="select" help="human, mouse, etc.">
      <option value="human" selected="True">Human</option>
     <option value="mouse" >Mouse</option> 
    </param>
    <!-- Additional parameters -->
    <!--<param type="data" name="auxiliary_data" label="optional_file" optional="true" format="text" help="germline J gene coding frame start position (position is 0-based), the J gene type, and the CDR3 end position for each sequence in the germline J sequence database (Fields are tab-delimited). Only for NCBI or IMGT germline gene sequence database"/>-->
  </inputs>

  <outputs>
    <data name="output" format="txt" />
  </outputs>

  <tests>
    <test>
      <param name="fastq_input" value="test.fastq" ftype="bam"/>
      <param name="seqtype" value="TCR"/>
      <param name="germline_db_V" value="database/tr_v"/>
      <param name="germline_db_J" value="database/tr_j"/>
      <param name="germline_db_D" value="database/tr_d"/>
      <param name="auxiliary_data" value="database/human_gl.aux" ftype="bed"/>
      <output name="output" file="database/test.output" lines_diff="4"/>
    </test>
  </tests>

  <help>
    <![CDATA[

**ToDo**
  
    ]]>
  </help>
  <citations>
    <citation type="bibtex">
      @misc{githubIgblast,
        author = {},
        year = {},
        title = {TBD},
        publisher = {GitHub},
        journal = {GitHub repository},
        url = {},
      }
    </citation>
  </citations>
</tool>
