<tool id="presto_alignsets" name="pRESTO AlignSets" version="@TOOL_VERSION@">
    <description>Multiple-align sequences with the same barcodes.</description>
       
    <macros>
        <import>presto_macros.xml</import>
    </macros>

    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">presto</requirement>
        <requirement type="package" version="@MUSCLE_VERSION@">muslce</requirement>
    </requirements>

    <version_command>AlignSets.py --version</version_command>
    <command detect_errors="exit_code"><![CDATA[
        ln -s '$fastq_in' in.fastq &&
        AlignSets.py '$method' 
          --nproc "\${GALAXY_SLOTS:-1}"
          -s in.fastq
          --bf '$bf'
          $div
          --outname=tmp
          #if $capture_log
            --log '$log_out'
          #end if
    ]]></command>

    <inputs>
        <param name="method" type="select" value="muscle" label="Alignment method" help="This step is to correct missalignment that is due to different primers in the multiplex pool having been incorporated into the same UMI read group during amplification if the primers are sufficiently similar.">
            <option value="muscle">Align sequence sets using muscle (muscle)</option>
            <option value="offset">Align sequence sets using predefined 5' offset (offset)</option>
            <option value="table"> Create a 5' offset table by primer multiple alignment (table)</option>
        </param>

        <param argument="-s" name="fastq_in" type="data" format="fastq" label="Input FASTQ file" help="FASTQ file of sequences with barcodes/UMIs in an annotation."/>
        <param argument="--bf" type="text" value="BARCODE" label="Barcode Field" help="Name of the annotation field which contains the barcode/UMI sequence."/>
        <param argument="--div" type="boolean" value="false" truevalue="--div" falsevalue="" label="Calculate Nucleotide Diversity" help="Specify to calculate nucleotide diversity of each set."/>
        <expand macro="presto-log-param"/>
    </inputs>

    <outputs>
        <data name="fastq_out" format="fastq" from_work_dir="tmp_align-pass.fastq"/>
        <expand macro="presto-log-output"/>
    </outputs>
    
    <tests>
        <test>
            <param name="fastq_in" value="presto_alignsets_test_in.fastq"/>
            <output name="fastq_out" file="presto_alignsets_test_out.fastq" compare="sim_size" delta="15"/>
        </test>
    </tests>
    
    <help><![CDATA[
Multiple aligns sequences with the same barcode to correct for any misalignments due to either different primer usage or insertions/deletions in the sequences.

Only supports the "muscle" sub-command of pRESTO's AlignSets.py.

See the `pRESTO online help <@PRESTO_BASE_URL@/en/stable>`_ for more information.

@HELP_NOTE@
    ]]></help>
    <expand macro="citations" />
</tool>
